// ConsultFlow v3.0 - Card View + Messaging + Timeline
import { useState, useEffect, useCallback } from "react";
import { createClient } from "@supabase/supabase-js";

const supabase = createClient(
  "https://mpcfozvnmddgyobkfnsk.supabase.co",
  "sb_publishable_qlB_iAuffoFcfrrM42M6og_fdvjMHiN"
);

const LOGO_SRC = "data:image/png;base64,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";
const CONSULTANTS = []; // Supabase profilleri kullanılıyor
const PRIORITY_CONFIG = {
  Critical: { color: "#FF3B5C", bg: "#FF3B5C20", label: "Kritik" },
  High:     { color: "#FF8C00", bg: "#FF8C0020", label: "Yüksek" },
  Medium:   { color: "#F5C518", bg: "#F5C51820", label: "Orta" },
  Low:      { color: "#30C97E", bg: "#30C97E20", label: "Düşük" },
};
const STATUS_CONFIG = {
  "Open":        { color: "#60A5FA", bg: "#60A5FA18", label: "Açık" },
  "In Progress": { color: "#A78BFA", bg: "#A78BFA18", label: "İşlemde" },
  "Waiting":     { color: "#F59E0B", bg: "#F59E0B18", label: "Bekliyor" },
  "Closed":      { color: "#6B7280", bg: "#6B728018", label: "Kapalı" },
};

// ─── ICONS ───────────────────────────────────────────────────────────────────
const Icon = ({ name, size = 16 }) => {
  const icons = {
    dashboard: <svg width={size} height={size} fill="none" stroke="currentColor" strokeWidth="1.8" viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>,
    companies:  <svg width={size} height={size} fill="none" stroke="currentColor" strokeWidth="1.8" viewBox="0 0 24 24"><path d="M3 21h18M9 8h1m5 0h1M9 12h1m5 0h1M9 16h1m5 0h1M5 21V5a2 2 0 012-2h10a2 2 0 012 2v16"/></svg>,
    tickets:    <svg width={size} height={size} fill="none" stroke="currentColor" strokeWidth="1.8" viewBox="0 0 24 24"><path d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"/></svg>,
    timesheet:  <svg width={size} height={size} fill="none" stroke="currentColor" strokeWidth="1.8" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9"/><path d="M12 7v5l3 3"/></svg>,
    invoices:   <svg width={size} height={size} fill="none" stroke="currentColor" strokeWidth="1.8" viewBox="0 0 24 24"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/></svg>,
    reports:    <svg width={size} height={size} fill="none" stroke="currentColor" strokeWidth="1.8" viewBox="0 0 24 24"><path d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>,
    users:      <svg width={size} height={size} fill="none" stroke="currentColor" strokeWidth="1.8" viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"/></svg>,
    plus:       <svg width={size} height={size} fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M12 5v14M5 12h14"/></svg>,
    chevron:    <svg width={size} height={size} fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M9 18l6-6-6-6"/></svg>,
    logout:     <svg width={size} height={size} fill="none" stroke="currentColor" strokeWidth="1.8" viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4M16 17l5-5-5-5M21 12H9"/></svg>,
    eye:        <svg width={size} height={size} fill="none" stroke="currentColor" strokeWidth="1.8" viewBox="0 0 24 24"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>,
    eyeoff:     <svg width={size} height={size} fill="none" stroke="currentColor" strokeWidth="1.8" viewBox="0 0 24 24"><path d="M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19m-6.72-1.07a3 3 0 11-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>,
    spinner:    <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83" strokeLinecap="round"/></svg>,
    check:      <svg width={size} height={size} fill="none" stroke="currentColor" strokeWidth="2.5" viewBox="0 0 24 24"><path d="M5 13l4 4L19 7"/></svg>,
    x:          <svg width={size} height={size} fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12"/></svg>,
    clock:      <svg width={size} height={size} fill="none" stroke="currentColor" strokeWidth="1.8" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9"/><path d="M12 7v5l3 3"/></svg>,
    trend_up:   <svg width={size} height={size} fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M23 6l-9.5 9.5-5-5L1 18"/><path d="M17 6h6v6"/></svg>,
    shield:     <svg width={size} height={size} fill="none" stroke="currentColor" strokeWidth="1.8" viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>,
    mail:       <svg width={size} height={size} fill="none" stroke="currentColor" strokeWidth="1.8" viewBox="0 0 24 24"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>,
    lock:       <svg width={size} height={size} fill="none" stroke="currentColor" strokeWidth="1.8" viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>,
    db:         <svg width={size} height={size} fill="none" stroke="currentColor" strokeWidth="1.8" viewBox="0 0 24 24"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>,
  };
  return icons[name] || null;
};

// ─── SHARED COMPONENTS ───────────────────────────────────────────────────────
const inp = { background: "#F8FAFC", border: "1px solid #CBD5E1", borderRadius: 8, padding: "10px 12px", color: "#1E3A5F", fontSize: 14, width: "100%", outline: "none", transition: "border-color 0.2s" };

function Badge({ label, color, bg }) {
  return <span style={{ background: bg, color, fontSize: 11, fontWeight: 600, padding: "3px 8px", borderRadius: 5, whiteSpace: "nowrap" }}>{label}</span>;
}

function Btn({ children, onClick, variant = "primary", size = "md", icon, disabled = false, loading = false, style: ex = {}, type = "button" }) {
  const sz = { sm: { fontSize: 12, padding: "6px 14px" }, md: { fontSize: 14, padding: "10px 18px" }, lg: { fontSize: 15, padding: "13px 24px" } }[size];
  const v = {
    primary:   { background: "linear-gradient(135deg,#1E40AF,#0E7490)", color: "#fff", border: "none" },
    secondary: { background: "#F8FAFC", color: "#64748B", border: "1px solid #1E2130" },
    danger:    { background: "#FF3B5C18", color: "#FF3B5C", border: "1px solid #FF3B5C30" },
    ghost:     { background: "transparent", color: "#64748B", border: "none" },
  }[variant] || {};
  return (
    <button type={type} onClick={onClick} disabled={disabled || loading}
      style={{ display: "inline-flex", alignItems: "center", justifyContent: "center", gap: 7, borderRadius: 9, fontWeight: 600, cursor: (disabled || loading) ? "not-allowed" : "pointer", opacity: (disabled || loading) ? 0.6 : 1, fontFamily: "inherit", transition: "all 0.15s ease", ...sz, ...v, ...ex }}>
      {loading ? <div style={{ animation: "spin 1s linear infinite" }}><Icon name="spinner" size={15} /></div> : icon && <Icon name={icon} size={15} />}
      {children}
    </button>
  );
}

function Modal({ title, onClose, children, width = 500 }) {
  return (
    <div style={{ position: "fixed", inset: 0, background: "rgba(0,0,0,0.75)", display: "flex", alignItems: "center", justifyContent: "center", zIndex: 200, backdropFilter: "blur(4px)" }}>
      <div style={{ background: "#FFFFFF", border: "1px solid #1E2130", borderRadius: 16, width, maxWidth: "95vw", maxHeight: "90vh", overflow: "auto", animation: "fadeIn 0.2s ease" }}>
        <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between", padding: "20px 24px 16px", borderBottom: "1px solid #1E2130" }}>
          <h3 style={{ fontSize: 16, fontWeight: 700, color: "#1E3A5F" }}>{title}</h3>
          <button onClick={onClose} style={{ background: "none", border: "none", color: "#64748B", cursor: "pointer", display: "flex", alignItems: "center", padding: 4, borderRadius: 6 }}><Icon name="x" size={18} /></button>
        </div>
        <div style={{ padding: "20px 24px" }}>{children}</div>
      </div>
    </div>
  );
}

function FormField({ label, children, required }) {
  return (
    <div style={{ marginBottom: 14 }}>
      <label style={{ fontSize: 12, fontWeight: 600, color: "#64748B", display: "block", marginBottom: 5, textTransform: "uppercase", letterSpacing: 0.5 }}>
        {label}{required && <span style={{ color: "#FF3B5C", marginLeft: 2 }}>*</span>}
      </label>
      {children}
    </div>
  );
}

function Toast({ message, type = "success" }) {
  const colors = { success: "#059669", error: "#FF3B5C", info: "#1D4ED8" };
  return (
    <div style={{ position: "fixed", bottom: 24, right: 24, background: "#FFFFFF", border: `1px solid ${colors[type]}40`, borderRadius: 10, padding: "12px 18px", display: "flex", alignItems: "center", gap: 10, zIndex: 999, boxShadow: "0 8px 32px rgba(0,0,0,0.5)", animation: "fadeIn 0.3s ease" }}>
      <span style={{ color: colors[type], fontSize: 16 }}>{type === "success" ? "✓" : type === "error" ? "✗" : "ℹ"}</span>
      <span style={{ fontSize: 13, color: "#E2E8F0" }}>{message}</span>
    </div>
  );
}

function StatCard({ label, value, sub, color = "#1D4ED8", icon }) {
  return (
    <div style={{ background: "#FFFFFF", border: "1px solid #1E2130", borderRadius: 12, padding: "18px 20px", position: "relative", overflow: "hidden" }}>
      <div style={{ position: "absolute", top: 0, left: 0, right: 0, height: 2, background: color }} />
      <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start" }}>
        <div>
          <div style={{ fontSize: 11, color: "#64748B", fontWeight: 500, marginBottom: 6, textTransform: "uppercase", letterSpacing: 0.8 }}>{label}</div>
          <div style={{ fontSize: 28, fontWeight: 700, color: "#1E3A5F", lineHeight: 1, fontFamily: "'DM Mono', monospace" }}>{value}</div>
          {sub && <div style={{ fontSize: 11, color: "#64748B", marginTop: 5 }}>{sub}</div>}
        </div>
        <div style={{ width: 38, height: 38, borderRadius: 10, background: color + "18", display: "flex", alignItems: "center", justifyContent: "center", color, flexShrink: 0 }}>
          <Icon name={icon} size={18} />
        </div>
      </div>
    </div>
  );
}


// ─── EMAIL HELPER ─────────────────────────────────────────────────────────────
const ADMIN_EMAIL = "cevdetayk53@gmail.com";
const ADMIN_NAME  = "Cevdet Ayk";

async function sendEmail({ to_email, to_name, subject, body }) {
  try {
    if (window.emailjs) {
      await window.emailjs.send(
        window.EMAILJS_SERVICE_ID  || "service_consultflow",
        window.EMAILJS_TEMPLATE_ID || "template_ticket",
        { to_email, to_name, subject, message: body, from_name: "ConsultFlow" }
      );
    }
  } catch (err) {
    console.warn("Email gönderilemedi:", err.message);
  }
}

async function notifyNewTicket({ ticket, company, createdBy }) {
  const priorityMap = { Critical: "Kritik", High: "Yuksek", Medium: "Orta", Low: "Dusuk" };
  await sendEmail({
    to_email: ADMIN_EMAIL,
    to_name:  ADMIN_NAME,
    subject:  "[ConsultFlow] Yeni Ticket: " + ticket.no + " - " + ticket.title,
    body: "Merhaba " + ADMIN_NAME + ",\n\nYeni bir destek talebi olusturuldu.\n\n" +
      "Ticket No    : " + ticket.no + "\n" +
      "Baslik       : " + ticket.title + "\n" +
      "Firma        : " + (company?.name || "-") + "\n" +
      "Oncelik      : " + (priorityMap[ticket.priority] || ticket.priority) + "\n" +
      "Olusturan    : " + createdBy + "\n" +
      "Tarih        : " + new Date().toLocaleDateString("tr-TR") + "\n\n" +
      (ticket.description ? "Aciklama: " + ticket.description + "\n\n" : "") +
      "ConsultFlow platformundan giris yaparak talebi goruntleyebilirsiniz."
  });
}

async function notifyAssignment({ ticket, company, consultantEmail, consultantName }) {
  const priorityMap = { Critical: "Kritik", High: "Yuksek", Medium: "Orta", Low: "Dusuk" };
  await sendEmail({
    to_email: consultantEmail,
    to_name:  consultantName,
    subject:  "[ConsultFlow] Size Yeni Ticket Atandi: " + ticket.no,
    body: "Merhaba " + consultantName + ",\n\nSize yeni bir destek talebi atandi.\n\n" +
      "Ticket No    : " + ticket.no + "\n" +
      "Baslik       : " + ticket.title + "\n" +
      "Firma        : " + (company?.name || "-") + "\n" +
      "Oncelik      : " + (priorityMap[ticket.priority] || ticket.priority) + "\n" +
      "Atanma       : " + new Date().toLocaleDateString("tr-TR") + "\n\n" +
      (ticket.description ? "Aciklama: " + ticket.description + "\n\n" : "") +
      "ConsultFlow platformuna giris yaparak talebi goruntuleyip yanitlayabilirsiniz."
  });
}

// ─── LOGIN PAGE ───────────────────────────────────────────────────────────────
function LoginPage({ onLogin }) {
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [showPass, setShowPass] = useState(false);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState("");

  const handleLogin = async (e) => {
    e.preventDefault();
    if (!email || !password) { setError("E-posta ve şifre gereklidir."); return; }
    setLoading(true);
    setError("");
    const { data, error: err } = await supabase.auth.signInWithPassword({ email, password });
    if (err) { setError("Hatalı e-posta veya şifre."); setLoading(false); return; }
    onLogin(data.user);
    setLoading(false);
  };

  return (
    <div style={{ minHeight: "100vh", background: "#F0F4F8", display: "flex", alignItems: "center", justifyContent: "center", fontFamily: "'DM Sans',system-ui,sans-serif", position: "relative", overflow: "hidden" }}>
      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600;9..40,700&family=DM+Mono:wght@400;500&display=swap');
        *{box-sizing:border-box;margin:0;padding:0}
        @keyframes fadeIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
        @keyframes spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
        @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
        @keyframes pulse{0%,100%{opacity:0.4}50%{opacity:0.8}}
        input::placeholder{color:#475569}
        input:focus{border-color:#6366F1!important}
      `}</style>

      {/* BG decorations */}
      <div style={{ position: "absolute", top: "10%", left: "5%", width: 300, height: 300, background: "radial-gradient(circle, #BFDBFE 0%, transparent 70%)", borderRadius: "50%", animation: "float 6s ease-in-out infinite" }} />
      <div style={{ position: "absolute", bottom: "10%", right: "5%", width: 250, height: 250, background: "radial-gradient(circle, #A7F3D0 0%, transparent 70%)", borderRadius: "50%", animation: "float 8s ease-in-out infinite reverse" }} />

      <div style={{ width: 420, animation: "fadeIn 0.5s ease", position: "relative", zIndex: 1 }}>
        {/* Logo */}
        <div style={{ textAlign: "center", marginBottom: 36 }}>
          <img src={LOGO_SRC} alt="ConsultFlow" style={{ width: 130, height: 130, objectFit: "contain", margin: "0 auto 4px", display: "block", filter: "drop-shadow(0 6px 20px rgba(30,64,175,0.18))" }} />
          <p style={{ fontSize: 13, color: "#64748B", marginTop: 0 }}>Danışmanlık Yönetim Platformu</p>
        </div>

        {/* Card */}
        <div style={{ background: "#FFFFFF", border: "1px solid #E2E8F0", borderRadius: 20, padding: "32px", boxShadow: "0 20px 60px rgba(30,58,138,0.1)" }}>
          <h2 style={{ fontSize: 18, fontWeight: 700, color: "#1E3A5F", marginBottom: 6 }}>Giriş Yap</h2>
          <p style={{ fontSize: 13, color: "#64748B", marginBottom: 24 }}>Hesabınıza giriş yapın</p>

          {error && (
            <div style={{ background: "#FF3B5C12", border: "1px solid #FF3B5C35", borderRadius: 8, padding: "10px 14px", marginBottom: 18, fontSize: 13, color: "#FF3B5C", display: "flex", alignItems: "center", gap: 8 }}>
              ⚠️ {error}
            </div>
          )}

          <form onSubmit={handleLogin}>
            <div style={{ marginBottom: 16 }}>
              <label style={{ fontSize: 12, fontWeight: 600, color: "#64748B", display: "block", marginBottom: 6, textTransform: "uppercase", letterSpacing: 0.5 }}>E-posta</label>
              <div style={{ position: "relative" }}>
                <div style={{ position: "absolute", left: 12, top: "50%", transform: "translateY(-50%)", color: "#64748B" }}><Icon name="mail" size={15} /></div>
                <input type="email" value={email} onChange={e => setEmail(e.target.value)} placeholder="ornek@firma.com" style={{ ...inp, paddingLeft: 38 }} />
              </div>
            </div>

            <div style={{ marginBottom: 24 }}>
              <label style={{ fontSize: 12, fontWeight: 600, color: "#64748B", display: "block", marginBottom: 6, textTransform: "uppercase", letterSpacing: 0.5 }}>Şifre</label>
              <div style={{ position: "relative" }}>
                <div style={{ position: "absolute", left: 12, top: "50%", transform: "translateY(-50%)", color: "#64748B" }}><Icon name="lock" size={15} /></div>
                <input type={showPass ? "text" : "password"} value={password} onChange={e => setPassword(e.target.value)} placeholder="••••••••" style={{ ...inp, paddingLeft: 38, paddingRight: 42 }} />
                <button type="button" onClick={() => setShowPass(p => !p)} style={{ position: "absolute", right: 12, top: "50%", transform: "translateY(-50%)", background: "none", border: "none", color: "#64748B", cursor: "pointer", display: "flex", alignItems: "center" }}>
                  <Icon name={showPass ? "eyeoff" : "eye"} size={15} />
                </button>
              </div>
            </div>

            <Btn type="submit" loading={loading} disabled={!email || !password} style={{ width: "100%", justifyContent: "center" }} size="lg">
              Giriş Yap
            </Btn>
          </form>

          <div style={{ marginTop: 20, padding: "14px", background: "#F8FAFC", borderRadius: 10, border: "1px solid #1E2130" }}>
            <div style={{ fontSize: 11, color: "#64748B", fontWeight: 600, marginBottom: 8, textTransform: "uppercase", letterSpacing: 0.5 }}>💡 Hesap bilgileri için</div>
            <div style={{ fontSize: 12, color: "#64748B", lineHeight: 1.6 }}>Admin, danışman veya müşteri hesabınız için yöneticinizle iletişime geçin.</div>
          </div>
        </div>

        <div style={{ textAlign: "center", marginTop: 20, display: "flex", alignItems: "center", justifyContent: "center", gap: 6 }}>
          <Icon name="db" size={12} />
          <span style={{ fontSize: 11, color: "#94A3B8" }}>Supabase ile güvende</span>
        </div>
      </div>
    </div>
  );
}

// ─── MAIN APP ─────────────────────────────────────────────────────────────────
export default function App() {
  const [user, setUser] = useState(null);
  const [profile, setProfile] = useState(null);
  const [authLoading, setAuthLoading] = useState(true);
  const [page, setPage] = useState("dashboard");
  const [sidebarOpen, setSidebarOpen] = useState(true);
  const [toast, setToast] = useState(null);
  const [companies, setCompanies] = useState([]);
  const [tickets, setTickets] = useState([]);
  const [timesheets, setTimesheets] = useState([]);
  const [invoices, setInvoices] = useState([]);
  const [consultants, setConsultants] = useState([]);
  const [dataLoading, setDataLoading] = useState(false);

  const showToast = useCallback((message, type = "success") => {
    setToast({ message, type });
    setTimeout(() => setToast(null), 3500);
  }, []);

  // Auth state
  useEffect(() => {
    supabase.auth.getSession().then(({ data: { session } }) => {
      if (session?.user) {
        setUser(session.user);
        loadProfile(session.user.id);
      } else {
        setAuthLoading(false);
      }
    });
    const { data: { subscription } } = supabase.auth.onAuthStateChange((_event, session) => {
      if (session?.user) {
        setUser(session.user);
        loadProfile(session.user.id);
      } else {
        setUser(null);
        setProfile(null);
        setAuthLoading(false);
      }
    });
    return () => subscription.unsubscribe();
  }, []);

  const loadProfile = async (userId) => {
    const { data } = await supabase.from("profiles").select("*, companies(*)").eq("id", userId).single();
    setProfile(data);
    setAuthLoading(false);
  };

  const loadAll = useCallback(async () => {
    if (!profile) return;
    setDataLoading(true);
    try {
      // Companies — RLS handles filtering automatically
      const { data: c } = await supabase.from("companies").select("*").order("created_at", { ascending: false });
      setCompanies(c || []);

      // Tickets — RLS handles filtering
      const { data: t } = await supabase.from("tickets").select("*").order("created_at", { ascending: false });
      setTickets(t || []);

      // Time entries
      const { data: ts } = await supabase.from("time_entries").select("*").order("created_at", { ascending: false });
      setTimesheets(ts || []);

      // Invoices
      const { data: inv } = await supabase.from("invoices").select("*").order("created_at", { ascending: false });
      setInvoices(inv || []);

      // Consultants - real users from profiles
      const { data: cons } = await supabase.from("profiles").select("id, full_name, email").eq("role", "consultant");
      setConsultants((cons || []).map(c => ({ id: c.id, name: c.full_name || c.email, email: c.email })));
    } catch (err) {
      showToast("Veri yüklenemedi: " + err.message, "error");
    }
    setDataLoading(false);
  }, [profile, showToast]);

  useEffect(() => { if (profile) loadAll(); }, [profile]);

  const handleLogout = async () => {
    await supabase.auth.signOut();
    setPage("dashboard");
  };

  const isAdmin = profile?.role === "admin";
  const isConsultant = profile?.role === "consultant";
  const isCustomer = profile?.role === "customer";

  const roleLabel = { admin: "Admin", consultant: "Danışman", customer: "Müşteri" }[profile?.role] || "";
  const roleColor = { admin: "#8B5CF6", consultant: "#1D4ED8", customer: "#059669" }[profile?.role] || "#1D4ED8";

  const nav = [
    { id: "dashboard", label: "Gösterge Paneli", icon: "dashboard", roles: ["admin", "consultant", "customer"] },
    { id: "companies",  label: "Firmalar",        icon: "companies",  roles: ["admin", "consultant"] },
    { id: "tickets",    label: "Ticket'lar",       icon: "tickets",    roles: ["admin", "consultant", "customer"] },
    { id: "timesheet",  label: "Efor Girişi",      icon: "timesheet",  roles: ["admin", "consultant"] },
    { id: "invoices",   label: "Faturalama",       icon: "invoices",   roles: ["admin", "customer"] },
    { id: "reports",    label: "Raporlar",         icon: "reports",    roles: ["admin", "consultant"] },
    { id: "admin",      label: "Admin Paneli",     icon: "shield",     roles: ["admin"] },
  ].filter(item => item.roles.includes(profile?.role));

  const criticalCount = tickets.filter(t => t.priority === "Critical" && t.status !== "Closed").length;
  const openCount = tickets.filter(t => t.status !== "Closed").length;
  const unbilledHours = timesheets.filter(t => !t.billed).reduce((s, t) => s + (t.hours || 0), 0);

  if (authLoading) {
    return (
      <div style={{ height: "100vh", background: "linear-gradient(135deg,#EFF6FF,#F0F9FF)", display: "flex", alignItems: "center", justifyContent: "center", flexDirection: "column", gap: 14, fontFamily: "'DM Sans',sans-serif" }}>
        <style>{`@keyframes spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}`}</style>
        <img src={LOGO_SRC} alt="ConsultFlow" style={{ width: 64, height: 64, objectFit: "contain" }} />
        <div style={{ animation: "spin 1s linear infinite", color: "#1D4ED8" }}><Icon name="spinner" size={24} /></div>
        <span style={{ fontSize: 13, color: "#64748B" }}>Yükleniyor...</span>
      </div>
    );
  }

  if (!user || !profile) return <LoginPage onLogin={(u) => { setUser(u); loadProfile(u.id); }} />;

  const pageProps = { companies, tickets, timesheets, invoices, consultants, reload: loadAll, showToast, profile, isAdmin, isConsultant, isCustomer, setPage, openCount, criticalCount, unbilledHours };

  return (
    <div style={{ display: "flex", height: "100vh", background: "#F1F5F9", fontFamily: "'DM Sans',system-ui,sans-serif", color: "#E2E8F0", overflow: "hidden" }}>
      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600;9..40,700&family=DM+Mono:wght@400;500&display=swap');
        *{box-sizing:border-box;margin:0;padding:0}
        ::-webkit-scrollbar{width:5px;height:5px}
        ::-webkit-scrollbar-track{background:#F1F5F9}
        ::-webkit-scrollbar-thumb{background:#CBD5E1;border-radius:4px}
        button,input,select,textarea{font-family:inherit}
        @keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
        @keyframes spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
        .page-enter{animation:fadeIn 0.3s ease both}
        .nav-item:hover{background:#EFF6FF!important;color:#1D4ED8!important}
        .tr-hover:hover{background:#F8FAFC!important}
        input:focus,select:focus,textarea:focus{border-color:#1D4ED8!important;outline:none;box-shadow:0 0 0 3px rgba(29,78,216,0.1)!important}
        input::placeholder,textarea::placeholder{color:#94A3B8}
        select option{background:#fff;color:#1E3A5F}
      `}</style>

      {/* SIDEBAR */}
      <aside style={{ width: sidebarOpen ? 228 : 64, background: "#FFFFFF", borderRight: "1px solid #E2E8F0", display: "flex", flexDirection: "column", transition: "width 0.25s ease", flexShrink: 0, zIndex: 10 }}>
        <div style={{ padding: "18px 14px 14px", borderBottom: "1px solid #1E2130", display: "flex", alignItems: "center", gap: 10 }}>
          <img src={LOGO_SRC} alt="CF" style={{ width: 36, height: 36, objectFit: "contain", flexShrink: 0 }} />
          {sidebarOpen && <div><div style={{ fontSize: 13, fontWeight: 700, color: "#1E3A5F" }}>ConsultFlow</div><div style={{ fontSize: 10, color: "#059669", display: "flex", alignItems: "center", gap: 4 }}><span style={{ width: 5, height: 5, borderRadius: "50%", background: "#059669", display: "inline-block" }} />Canlı</div></div>}
        </div>

        <nav style={{ flex: 1, padding: "10px 8px", display: "flex", flexDirection: "column", gap: 2, overflowY: "auto" }}>
          {nav.map(item => (
            <button key={item.id} className="nav-item" onClick={() => setPage(item.id)}
              style={{ display: "flex", alignItems: "center", gap: 10, padding: "9px 10px", borderRadius: 8, border: "none", background: page === item.id ? "#EFF6FF" : "transparent", color: page === item.id ? "#1D4ED8" : "#64748B", fontWeight: page === item.id ? 600 : 400, fontSize: 13, textAlign: "left", width: "100%", cursor: "pointer" }}>
              <span style={{ flexShrink: 0, color: page === item.id ? "#1D4ED8" : "#64748B" }}><Icon name={item.icon} size={17} /></span>
              {sidebarOpen && <span style={{ flex: 1, whiteSpace: "nowrap" }}>{item.label}</span>}
              {item.id === "tickets" && criticalCount > 0 && (
                <span style={{ background: "#FF3B5C", color: "#fff", fontSize: 10, fontWeight: 700, padding: "1px 6px", borderRadius: 10, marginLeft: "auto", flexShrink: 0 }}>{criticalCount}</span>
              )}
            </button>
          ))}
        </nav>

        {/* User info */}
        <div style={{ padding: "10px 8px", borderTop: "1px solid #1E2130" }}>
          {sidebarOpen && (
            <div style={{ display: "flex", alignItems: "center", gap: 10, padding: "10px", background: "#F8FAFC", borderRadius: 10, marginBottom: 8 }}>
              <div style={{ width: 32, height: 32, borderRadius: "50%", background: roleColor + "20", border: `1.5px solid ${roleColor}40`, display: "flex", alignItems: "center", justifyContent: "center", fontSize: 12, fontWeight: 700, color: roleColor, flexShrink: 0 }}>
                {(profile.full_name || profile.email || "?")[0].toUpperCase()}
              </div>
              <div style={{ flex: 1, minWidth: 0 }}>
                <div style={{ fontSize: 12, fontWeight: 600, color: "#334E68", whiteSpace: "nowrap", overflow: "hidden", textOverflow: "ellipsis" }}>{profile.full_name || profile.email}</div>
                <div style={{ fontSize: 10, color: roleColor, fontWeight: 600 }}>{roleLabel}</div>
              </div>
            </div>
          )}
          <button className="nav-item" onClick={() => setSidebarOpen(p => !p)}
            style={{ display: "flex", alignItems: "center", gap: 10, padding: "8px 10px", borderRadius: 8, border: "none", background: "transparent", color: "#64748B", fontSize: 12, width: "100%", cursor: "pointer", marginBottom: 4 }}>
            <span style={{ transform: sidebarOpen ? "rotate(180deg)" : "none", transition: "transform 0.25s ease", display: "inline-block" }}><Icon name="chevron" size={15} /></span>
            {sidebarOpen && "Daralt"}
          </button>
          <button className="nav-item" onClick={handleLogout}
            style={{ display: "flex", alignItems: "center", gap: 10, padding: "8px 10px", borderRadius: 8, border: "none", background: "transparent", color: "#FF3B5C", fontSize: 12, width: "100%", cursor: "pointer" }}>
            <Icon name="logout" size={15} />
            {sidebarOpen && "Çıkış Yap"}
          </button>
        </div>
      </aside>

      {/* MAIN */}
      <div style={{ flex: 1, display: "flex", flexDirection: "column", overflow: "hidden" }}>
        <header style={{ height: 52, background: "#FFFFFF", borderBottom: "1px solid #1E2130", display: "flex", alignItems: "center", justifyContent: "space-between", padding: "0 22px", flexShrink: 0 }}>
          <div style={{ fontSize: 13, color: "#64748B" }}>
            {isCustomer && profile.companies && (
              <span style={{ color: "#1D4ED8", fontWeight: 600 }}>🏢 {profile.companies.name}</span>
            )}
            {(isAdmin || isConsultant) && <span>Hoş geldiniz, <span style={{ color: "#64748B", fontWeight: 600 }}>{profile.full_name || profile.email}</span></span>}
          </div>
          <div style={{ display: "flex", alignItems: "center", gap: 10 }}>
            <span style={{ fontSize: 11, background: roleColor + "15", color: roleColor, border: `1px solid ${roleColor}30`, borderRadius: 6, padding: "4px 10px", fontWeight: 600 }}>{roleLabel}</span>
            {dataLoading && <div style={{ animation: "spin 1s linear infinite", color: "#1D4ED8" }}><Icon name="spinner" size={14} /></div>}
          </div>
        </header>

        <main style={{ flex: 1, overflow: "auto", padding: "22px" }}>
          {page === "dashboard"  && <DashboardPage {...pageProps} />}
          {page === "companies"  && <CompaniesPage {...pageProps} />}
          {page === "tickets"    && <TicketsPage {...pageProps} />}
          {page === "timesheet"  && <TimesheetPage {...pageProps} />}
          {page === "invoices"   && <InvoicesPage {...pageProps} />}
          {page === "reports"    && <ReportsPage {...pageProps} />}
          {page === "admin"      && isAdmin && <AdminPage {...pageProps} />}
        </main>
      </div>
      {toast && <Toast message={toast.message} type={toast.type} />}
    </div>
  );
}

// ─── DASHBOARD ────────────────────────────────────────────────────────────────
function DashboardPage({ tickets, timesheets, invoices, companies, openCount, criticalCount, unbilledHours, setPage, isCustomer, isAdmin, profile }) {
  const totalRevenue = invoices.reduce((s, i) => s + (i.total || 0), 0);
  const recentTickets = tickets.slice(0, 5);

  return (
    <div className="page-enter">
      <div style={{ marginBottom: 20 }}>
        <h2 style={{ fontSize: 20, fontWeight: 700, color: "#1E3A5F" }}>Gösterge Paneli</h2>
        <p style={{ fontSize: 13, color: "#64748B", marginTop: 3 }}>
          {isCustomer ? `${profile.companies?.name || ""} — Hoş geldiniz` : "Danışmanlık operasyonlarına genel bakış"}
        </p>
      </div>

      <div style={{ display: "grid", gridTemplateColumns: isCustomer ? "repeat(2,1fr)" : "repeat(4,1fr)", gap: 14, marginBottom: 22 }}>
        <StatCard label="Açık Ticket" value={openCount} sub={`${criticalCount} kritik`} color="#1D4ED8" icon="tickets" />
        {!isCustomer && <StatCard label="Faturalanmamış" value={unbilledHours.toFixed(1) + "s"} color="#F59E0B" icon="clock" />}
        {isAdmin && <StatCard label="Tahsilat" value={"₺" + (totalRevenue / 1000).toFixed(1) + "K"} color="#059669" icon="trend_up" />}
        {isAdmin && <StatCard label="Firmalar" value={companies.length} color="#8B5CF6" icon="companies" />}
        {isCustomer && <StatCard label="Toplam Ticket" value={tickets.length} color="#8B5CF6" icon="tickets" />}
      </div>

      <div style={{ background: "#FFFFFF", border: "1px solid #1E2130", borderRadius: 12, padding: "20px" }}>
        <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 14 }}>
          <h3 style={{ fontSize: 14, fontWeight: 700, color: "#1E3A5F" }}>Son Ticket'lar</h3>
          <button onClick={() => setPage("tickets")} style={{ fontSize: 12, color: "#1D4ED8", background: "none", border: "none", cursor: "pointer", fontWeight: 600 }}>Tümünü Gör →</button>
        </div>
        {recentTickets.length === 0
          ? <div style={{ textAlign: "center", color: "#64748B", fontSize: 13, padding: "30px 0" }}>Henüz ticket yok.</div>
          : recentTickets.map(t => (
            <div key={t.id} style={{ display: "flex", alignItems: "center", gap: 12, padding: "10px 12px", background: "#F8FAFC", borderRadius: 8, marginBottom: 7, border: "1px solid #1E213040" }}>
              <div style={{ flex: 1, minWidth: 0 }}>
                <div style={{ display: "flex", alignItems: "center", gap: 7, marginBottom: 2 }}>
                  <span style={{ fontSize: 10, color: "#64748B", fontFamily: "'DM Mono',monospace" }}>{t.no}</span>
                  {t.priority && <Badge {...PRIORITY_CONFIG[t.priority]} label={PRIORITY_CONFIG[t.priority]?.label} />}
                </div>
                <div style={{ fontSize: 13, fontWeight: 500, color: "#334E68", whiteSpace: "nowrap", overflow: "hidden", textOverflow: "ellipsis" }}>{t.title}</div>
                <div style={{ fontSize: 11, color: "#64748B", marginTop: 2 }}>{companies.find(c => c.id === t.company_id)?.name || "—"}</div>
              </div>
              {t.status && <Badge {...STATUS_CONFIG[t.status]} label={STATUS_CONFIG[t.status]?.label} />}
            </div>
          ))
        }
      </div>
    </div>
  );
}

// ─── COMPANIES ────────────────────────────────────────────────────────────────
function CompaniesPage({ companies, reload, showToast, isAdmin }) {
  const [showModal, setShowModal] = useState(false);
  const [saving, setSaving] = useState(false);
  const empty = { name: "", tax_no: "", city: "", contact: "", email: "", contract_type: "Saatlik", hourly_rate: "", currency: "TRY", billing_period: "Aylık" };
  const [form, setForm] = useState(empty);
  const cc = { Saatlik: "#1D4ED8", "Adam/Gün": "#059669", "Sabit Aylık": "#F59E0B", Retainer: "#8B5CF6" };

  const save = async () => {
    if (!form.name) return;
    setSaving(true);
    const { error } = await supabase.from("companies").insert([{ ...form, hourly_rate: +form.hourly_rate }]);
    setSaving(false);
    if (error) { showToast(error.message, "error"); return; }
    showToast("Firma eklendi!"); setShowModal(false); setForm(empty); reload();
  };

  return (
    <div className="page-enter">
      <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start", marginBottom: 20 }}>
        <div><h2 style={{ fontSize: 20, fontWeight: 700, color: "#1E3A5F" }}>Firmalar</h2><p style={{ fontSize: 13, color: "#64748B", marginTop: 3 }}>{companies.length} firma</p></div>
        {isAdmin && <Btn icon="plus" onClick={() => setShowModal(true)}>Firma Ekle</Btn>}
      </div>
      {companies.length === 0
        ? <div style={{ textAlign: "center", padding: "60px 0", color: "#64748B" }}><div style={{ fontSize: 40, marginBottom: 12 }}>🏢</div><div>Henüz firma eklenmedi.</div></div>
        : <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fill,minmax(300px,1fr))", gap: 14 }}>
          {companies.map(c => (
            <div key={c.id} style={{ background: "#FFFFFF", border: "1px solid #1E2130", borderRadius: 12, padding: "20px", position: "relative", overflow: "hidden" }}>
              <div style={{ position: "absolute", top: 0, left: 0, right: 0, height: 2, background: cc[c.contract_type] || "#1D4ED8" }} />
              <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start", marginBottom: 12 }}>
                <div style={{ width: 40, height: 40, background: (cc[c.contract_type] || "#1D4ED8") + "18", borderRadius: 10, display: "flex", alignItems: "center", justifyContent: "center", fontSize: 16, fontWeight: 800, color: cc[c.contract_type] || "#1D4ED8" }}>{c.name?.[0]}</div>
                <Badge label={c.contract_type} color={cc[c.contract_type] || "#1D4ED8"} bg={(cc[c.contract_type] || "#1D4ED8") + "18"} />
              </div>
              <div style={{ fontSize: 15, fontWeight: 700, color: "#1E3A5F", marginBottom: 2 }}>{c.name}</div>
              <div style={{ fontSize: 12, color: "#64748B", marginBottom: 12 }}>{c.email}</div>
              <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 8 }}>
                {[["Yetkili", c.contact], ["Şehir", c.city], ["Vergi No", c.tax_no], ["Birim Ücret", `${c.currency} ${c.hourly_rate}`]].map(([l, v]) => (
                  <div key={l} style={{ background: "#F8FAFC", borderRadius: 7, padding: "7px 10px" }}>
                    <div style={{ fontSize: 10, color: "#64748B", fontWeight: 600, marginBottom: 2, textTransform: "uppercase" }}>{l}</div>
                    <div style={{ fontSize: 12, color: "#334E68" }}>{v || "—"}</div>
                  </div>
                ))}
              </div>
            </div>
          ))}
        </div>
      }
      {showModal && (
        <Modal title="Yeni Firma" onClose={() => setShowModal(false)}>
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: "0 14px" }}>
            <div style={{ gridColumn: "1/-1" }}><FormField label="Firma Adı" required><input style={inp} value={form.name} onChange={e => setForm(p => ({ ...p, name: e.target.value }))} /></FormField></div>
            <FormField label="Vergi No"><input style={inp} value={form.tax_no} onChange={e => setForm(p => ({ ...p, tax_no: e.target.value }))} /></FormField>
            <FormField label="Şehir"><input style={inp} value={form.city} onChange={e => setForm(p => ({ ...p, city: e.target.value }))} /></FormField>
            <FormField label="Yetkili"><input style={inp} value={form.contact} onChange={e => setForm(p => ({ ...p, contact: e.target.value }))} /></FormField>
            <FormField label="E-posta"><input style={inp} value={form.email} onChange={e => setForm(p => ({ ...p, email: e.target.value }))} /></FormField>
            <FormField label="Sözleşme"><select style={inp} value={form.contract_type} onChange={e => setForm(p => ({ ...p, contract_type: e.target.value }))}>{["Saatlik","Adam/Gün","Sabit Aylık","Retainer"].map(t => <option key={t}>{t}</option>)}</select></FormField>
            <FormField label="Birim Ücret"><input style={inp} type="number" value={form.hourly_rate} onChange={e => setForm(p => ({ ...p, hourly_rate: e.target.value }))} /></FormField>
            <FormField label="Para Birimi"><select style={inp} value={form.currency} onChange={e => setForm(p => ({ ...p, currency: e.target.value }))}>{["TRY","USD","EUR"].map(c => <option key={c}>{c}</option>)}</select></FormField>
            <FormField label="Faturalama"><select style={inp} value={form.billing_period} onChange={e => setForm(p => ({ ...p, billing_period: e.target.value }))}>{["Aylık","Proje Sonu"].map(p => <option key={p}>{p}</option>)}</select></FormField>
          </div>
          <div style={{ display: "flex", gap: 10, justifyContent: "flex-end", marginTop: 8 }}>
            <Btn variant="secondary" onClick={() => setShowModal(false)}>İptal</Btn>
            <Btn onClick={save} loading={saving} disabled={!form.name}>Kaydet</Btn>
          </div>
        </Modal>
      )}
    </div>
  );
}

// ─── TICKETS ─────────────────────────────────────────────────────────────────
function TicketsPage({ tickets, companies, timesheets, consultants, reload, showToast, profile, isAdmin, isConsultant, isCustomer }) {
  const [sel, setSel] = useState(null);
  const [showModal, setShowModal] = useState(false);
  const [saving, setSaving] = useState(false);
  const [fStatus, setFStatus] = useState("all");
  const [msgs, setMsgs] = useState({});
  const [newMsg, setNewMsg] = useState("");
  const [efors, setEfors] = useState({});
  const [showEforForm, setShowEforForm] = useState(false);
  const [eforForm, setEforForm] = useState({ date: new Date().toISOString().slice(0,10), hours: "", description: "" });
  const [savingEfor, setSavingEfor] = useState(false);
  const empty = { title: "", description: "", company_id: isCustomer ? profile.company_id : "", priority: "Medium", assignee: "" };
  const [form, setForm] = useState(empty);

  const filtered = tickets.filter(t => fStatus === "all" || t.status === fStatus);

  // Load messages and efors from DB for selected ticket
  useEffect(() => {
    if (sel) loadTicketData(sel.id, sel.no);
  }, [sel?.id]);

  const loadTicketData = async (ticketId, ticketNo) => {
    const { data: m } = await supabase.from("ticket_messages").select("*").eq("ticket_id", ticketId).order("created_at");
    if (m) setMsgs(p => ({ ...p, [ticketId]: m }));
    const { data: e } = await supabase.from("time_entries").select("*").eq("ticket_no", ticketNo).order("date");
    if (e) setEfors(p => ({ ...p, [ticketNo]: e }));
  };

  const save = async () => {
    if (!form.title) return;
    const companyId = isCustomer ? profile.company_id : form.company_id;
    if (!companyId) { showToast("Lütfen firma seçin", "error"); return; }
    setSaving(true);
    const no = "TKT-" + Date.now().toString().slice(-6);
    const ticketData = { ...form, company_id: companyId, no, status: "Open", assignee: form.assignee || null };
    const { error } = await supabase.from("tickets").insert([ticketData]);
    setSaving(false);
    if (error) { showToast(error.message, "error"); return; }
    showToast("Ticket oluşturuldu!"); setShowModal(false); setForm(empty); reload();
    // Admin'e mail gönder
    const company = companies.find(c => c.id === companyId);
    notifyNewTicket({ ticket: { ...ticketData, no }, company, createdBy: profile.full_name || profile.email });
  };

  const changeStatus = async (ticket, status) => {
    await supabase.from("tickets").update({ status, closed_at: status === "Closed" ? new Date().toISOString() : null }).eq("id", ticket.id);
    showToast("Durum: " + STATUS_CONFIG[status]?.label);
    setSel(p => p ? { ...p, status } : p);
    reload();
  };

  const assignConsultant = async (ticket, assignee) => {
    const { error } = await supabase.from("tickets").update({ assignee, status: ticket.status === "Open" ? "In Progress" : ticket.status }).eq("id", ticket.id);
    if (error) { showToast(error.message, "error"); return; }
    showToast(assignee + " atandı!");
    setSel(p => p ? { ...p, assignee, status: p.status === "Open" ? "In Progress" : p.status } : p);
    reload();
    // Danışmana mail gönder - e-postasını profiles'dan bul
    const consultantProfile = consultants.find(c => c.name === assignee);
    if (consultantProfile?.email) {
      const company = companies.find(c => c.id === ticket.company_id);
      notifyAssignment({ ticket, company, consultantEmail: consultantProfile.email, consultantName: assignee });
    }
  };

  const sendMsg = async () => {
    if (!newMsg.trim() || !sel) return;
    const msgData = { ticket_id: sel.id, author_name: profile.full_name || profile.email, author_role: profile.role, message: newMsg };
    const { data, error } = await supabase.from("ticket_messages").insert([msgData]).select().single();
    if (error) {
      // Fallback: store locally if table doesn't exist yet
      const time = new Date().toLocaleTimeString("tr", { hour: "2-digit", minute: "2-digit" });
      setMsgs(p => ({ ...p, [sel.id]: [...(p[sel.id] || []), { id: Date.now(), author_name: profile.full_name || profile.email, author_role: profile.role, message: newMsg, created_at: new Date().toISOString() }] }));
    } else {
      setMsgs(p => ({ ...p, [sel.id]: [...(p[sel.id] || []), data] }));
    }
    setNewMsg("");
  };

  const saveEfor = async () => {
    if (!eforForm.hours || !sel) return;
    setSavingEfor(true);
    const { data, error } = await supabase.from("time_entries").insert([{ consultant: profile.full_name || profile.email, ticket_no: sel.no, date: eforForm.date, hours: +eforForm.hours, description: eforForm.description, billed: false }]).select().single();
    setSavingEfor(false);
    if (error) { showToast(error.message, "error"); return; }
    showToast(eforForm.hours + " saat kaydedildi!");
    setEfors(p => ({ ...p, [sel.no]: [...(p[sel.no] || []), data] }));
    setEforForm({ date: new Date().toISOString().slice(0,10), hours: "", description: "" });
    setShowEforForm(false);
    reload();
  };

  // ── TICKET DETAIL ──
  if (sel) {
    const ticketMsgs = msgs[sel.id] || [];
    const ticketTime = efors[sel.no] || timesheets.filter(t => t.ticket_no === sel.no);
    const totalHrs = ticketTime.reduce((s, t) => s + (t.hours || 0), 0);
    const company = companies.find(c => c.id === sel.company_id);
    const priorityCfg = PRIORITY_CONFIG[sel.priority] || {};
    const statusCfg = STATUS_CONFIG[sel.status] || {};

    return (
      <div className="page-enter">
        {/* Breadcrumb */}
        <div style={{ display: "flex", alignItems: "center", gap: 10, marginBottom: 20 }}>
          <button onClick={() => { setSel(null); setShowEforForm(false); }} style={{ background: "#F8FAFC", border: "1px solid #1E2130", borderRadius: 7, padding: "7px 14px", color: "#64748B", fontSize: 13, cursor: "pointer" }}>← Geri</button>
          <span style={{ color: "#94A3B8" }}>/</span>
          <span style={{ fontSize: 13, color: "#1D4ED8", fontFamily: "'DM Mono',monospace", fontWeight: 700, background: "#1E40AF12", padding: "4px 12px", borderRadius: 6, border: "1px solid #6366F130" }}>{sel.no}</span>
          <div style={{ marginLeft: "auto", display: "flex", gap: 8 }}>
            {priorityCfg.color && <Badge {...priorityCfg} label={priorityCfg.label} />}
            {statusCfg.color && <Badge {...statusCfg} label={statusCfg.label} />}
          </div>
        </div>

        <div style={{ display: "grid", gridTemplateColumns: "1fr 320px", gap: 18 }}>
          {/* LEFT COLUMN */}
          <div style={{ display: "flex", flexDirection: "column", gap: 16 }}>

            {/* Ticket Info */}
            <div style={{ background: "#FFFFFF", border: "1px solid #1E2130", borderRadius: 14, padding: "22px", position: "relative", overflow: "hidden" }}>
              <div style={{ position: "absolute", top: 0, left: 0, right: 0, height: 3, background: priorityCfg.color || "#1D4ED8" }} />
              <div style={{ fontSize: 11, color: "#64748B", marginBottom: 6, textTransform: "uppercase", letterSpacing: 1 }}>{company?.name}</div>
              <h1 style={{ fontSize: 20, fontWeight: 800, color: "#1E3A5F", marginBottom: 10 }}>{sel.title}</h1>
              <p style={{ fontSize: 14, color: "#64748B", lineHeight: 1.7 }}>{sel.description || "Açıklama eklenmemiş."}</p>
              <div style={{ display: "flex", gap: 16, marginTop: 16, paddingTop: 14, borderTop: "1px solid #1E2130" }}>
                <div style={{ fontSize: 12, color: "#64748B" }}>📅 {sel.created_at?.slice(0,10)}</div>
                <div style={{ fontSize: 12, color: "#64748B" }}>⏱️ {totalHrs} saat toplam efor</div>
                {sel.assignee && <div style={{ fontSize: 12, color: "#1D4ED8" }}>👤 {sel.assignee}</div>}
              </div>
            </div>

            {/* Mesajlaşma */}
            <div style={{ background: "#FFFFFF", border: "1px solid #1E2130", borderRadius: 14, padding: "20px" }}>
              <h3 style={{ fontSize: 14, fontWeight: 700, color: "#1E3A5F", marginBottom: 14, display: "flex", alignItems: "center", gap: 8 }}>
                💬 Mesajlar
                <span style={{ fontSize: 11, color: "#64748B", fontWeight: 400 }}>Müşteri & Danışman iletişimi</span>
              </h3>
              <div style={{ minHeight: 100, maxHeight: 340, overflowY: "auto", marginBottom: 14, display: "flex", flexDirection: "column", gap: 10, padding: "4px 0" }}>
                {ticketMsgs.length === 0
                  ? <div style={{ textAlign: "center", color: "#94A3B8", fontSize: 13, padding: "30px 0" }}>Henüz mesaj yok. İlk mesajı gönderin!</div>
                  : ticketMsgs.map((m, i) => {
                    const isMe = m.author_role === profile.role;
                    const isCustomerMsg = m.author_role === "customer";
                    return (
                      <div key={m.id || i} style={{ display: "flex", flexDirection: "column", alignItems: isCustomerMsg ? "flex-end" : "flex-start" }}>
                        <div style={{ maxWidth: "78%", background: isCustomerMsg ? "linear-gradient(135deg,#6366F120,#8B5CF620)" : "#F8FAFC", border: isCustomerMsg ? "1px solid #6366F135" : "1px solid #1E2130", borderRadius: isCustomerMsg ? "14px 14px 4px 14px" : "14px 14px 14px 4px", padding: "10px 14px" }}>
                          <div style={{ display: "flex", gap: 10, marginBottom: 5, alignItems: "center" }}>
                            <span style={{ fontSize: 11, fontWeight: 700, color: isCustomerMsg ? "#1D4ED8" : "#059669" }}>{m.author_name}</span>
                            <span style={{ fontSize: 10, color: "#94A3B8" }}>{new Date(m.created_at).toLocaleTimeString("tr", { hour: "2-digit", minute: "2-digit" })}</span>
                          </div>
                          <p style={{ fontSize: 13, color: "#334E68", lineHeight: 1.6 }}>{m.message}</p>
                        </div>
                      </div>
                    );
                  })}
              </div>
              <div style={{ display: "flex", gap: 8 }}>
                <input value={newMsg} onChange={e => setNewMsg(e.target.value)} onKeyDown={e => e.key === "Enter" && sendMsg()} placeholder="Mesaj yazın... (Enter ile gönderin)" style={{ ...inp, flex: 1, borderRadius: 10 }} />
                <button onClick={sendMsg} disabled={!newMsg.trim()} style={{ background: "linear-gradient(135deg,#1E40AF,#0E7490)", border: "none", borderRadius: 10, padding: "0 18px", color: "#fff", fontWeight: 700, cursor: newMsg.trim() ? "pointer" : "not-allowed", opacity: newMsg.trim() ? 1 : 0.5, fontSize: 13 }}>Gönder</button>
              </div>
            </div>

            {/* Zaman Çizelgesi */}
            <div style={{ background: "#FFFFFF", border: "1px solid #1E2130", borderRadius: 14, padding: "20px" }}>
              <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 16 }}>
                <h3 style={{ fontSize: 14, fontWeight: 700, color: "#1E3A5F", display: "flex", alignItems: "center", gap: 8 }}>
                  📊 Zaman Çizelgesi
                  <span style={{ fontSize: 11, background: "#1E40AF12", color: "#1D4ED8", padding: "2px 8px", borderRadius: 5, fontWeight: 600 }}>{totalHrs}s toplam</span>
                </h3>
                {(isAdmin || isConsultant) && (
                  <button onClick={() => setShowEforForm(p => !p)} style={{ background: showEforForm ? "#FF3B5C18" : "linear-gradient(135deg,#1E40AF,#0E7490)", border: showEforForm ? "1px solid #FF3B5C30" : "none", borderRadius: 8, padding: "7px 14px", color: showEforForm ? "#FF3B5C" : "#fff", fontSize: 12, fontWeight: 600, cursor: "pointer" }}>
                    {showEforForm ? "✕ İptal" : "+ Efor Gir"}
                  </button>
                )}
              </div>

              {showEforForm && (
                <div style={{ background: "#F8FAFC", borderRadius: 10, padding: "14px", marginBottom: 16, border: "1px solid #6366F130", animation: "fadeIn 0.2s ease" }}>
                  <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: "0 12px", marginBottom: 10 }}>
                    <FormField label="Tarih"><input type="date" style={inp} value={eforForm.date} onChange={e => setEforForm(p => ({ ...p, date: e.target.value }))} /></FormField>
                    <FormField label="Süre (Saat)"><input type="number" step="0.5" min="0.5" style={inp} value={eforForm.hours} onChange={e => setEforForm(p => ({ ...p, hours: e.target.value }))} placeholder="0.5, 1, 2..."/></FormField>
                  </div>
                  <FormField label="Açıklama"><input style={inp} value={eforForm.description} onChange={e => setEforForm(p => ({ ...p, description: e.target.value }))} placeholder="Yapılan iş açıklaması" /></FormField>
                  <div style={{ display: "flex", justifyContent: "flex-end", marginTop: 8 }}>
                    <button onClick={saveEfor} disabled={savingEfor || !eforForm.hours} style={{ background: "linear-gradient(135deg,#1E40AF,#0E7490)", border: "none", borderRadius: 8, padding: "8px 20px", color: "#fff", fontSize: 13, fontWeight: 600, cursor: "pointer", opacity: !eforForm.hours ? 0.5 : 1 }}>
                      {savingEfor ? "Kaydediliyor..." : "Kaydet"}
                    </button>
                  </div>
                </div>
              )}

              {ticketTime.length === 0 ? (
                <div style={{ textAlign: "center", color: "#94A3B8", fontSize: 13, padding: "20px 0" }}>Henüz efor girilmedi.</div>
              ) : (
                <div style={{ position: "relative" }}>
                  {/* Timeline line */}
                  <div style={{ position: "absolute", left: 16, top: 8, bottom: 8, width: 2, background: "linear-gradient(to bottom, #6366F1, #1E2130)", borderRadius: 2 }} />
                  {ticketTime.map((t, i) => (
                    <div key={t.id || i} style={{ display: "flex", gap: 16, marginBottom: 16, position: "relative" }}>
                      <div style={{ width: 34, height: 34, borderRadius: "50%", background: t.billed ? "#D1FAE5" : "#1E40AF15", border: `2px solid ${t.billed ? "#059669" : "#1D4ED8"}`, display: "flex", alignItems: "center", justifyContent: "center", flexShrink: 0, zIndex: 1 }}>
                        <span style={{ fontSize: 10, fontWeight: 800, color: t.billed ? "#059669" : "#1D4ED8", fontFamily: "'DM Mono',monospace" }}>{t.hours}s</span>
                      </div>
                      <div style={{ flex: 1, background: "#F8FAFC", borderRadius: 10, padding: "10px 14px", border: "1px solid #1E2130" }}>
                        <div style={{ display: "flex", justifyContent: "space-between", marginBottom: 4 }}>
                          <span style={{ fontSize: 12, fontWeight: 600, color: "#334E68" }}>{t.consultant}</span>
                          <div style={{ display: "flex", gap: 8, alignItems: "center" }}>
                            <span style={{ fontSize: 11, color: "#64748B" }}>{t.date}</span>
                            {t.billed ? <span style={{ fontSize: 10, background: "#D1FAE5", color: "#059669", padding: "1px 6px", borderRadius: 4, fontWeight: 600 }}>Faturalandı</span> : <span style={{ fontSize: 10, background: "#F59E0B18", color: "#F59E0B", padding: "1px 6px", borderRadius: 4, fontWeight: 600 }}>Bekliyor</span>}
                          </div>
                        </div>
                        <p style={{ fontSize: 12, color: "#64748B" }}>{t.description}</p>
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>
          </div>

          {/* RIGHT COLUMN */}
          <div style={{ display: "flex", flexDirection: "column", gap: 12 }}>

            {/* Danışman Atama - Admin için */}
            {isAdmin && (
              <div style={{ background: "#FFFFFF", border: "1px solid #1E2130", borderRadius: 14, padding: "18px" }}>
                <h3 style={{ fontSize: 13, fontWeight: 700, color: "#1E3A5F", marginBottom: 12 }}>👤 Danışman Ata</h3>
                {sel.assignee ? (
                  <div style={{ background: "#1E40AF12", border: "1px solid #6366F130", borderRadius: 8, padding: "10px 12px", marginBottom: 10, display: "flex", alignItems: "center", gap: 8 }}>
                    <div style={{ width: 28, height: 28, borderRadius: "50%", background: "linear-gradient(135deg,#1E3A8A,#0E7490)", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 11, fontWeight: 700, color: "#fff" }}>{sel.assignee[0]}</div>
                    <div>
                      <div style={{ fontSize: 12, fontWeight: 600, color: "#1D4ED8" }}>{sel.assignee}</div>
                      <div style={{ fontSize: 10, color: "#64748B" }}>Atanmış danışman</div>
                    </div>
                  </div>
                ) : (
                  <div style={{ fontSize: 12, color: "#F59E0B", background: "#F59E0B12", border: "1px solid #F59E0B30", borderRadius: 7, padding: "8px 10px", marginBottom: 10 }}>⚠️ Danışman atanmadı</div>
                )}
                <div style={{ display: "flex", flexDirection: "column", gap: 5 }}>
                  {consultants.map(c => (
                    <button key={c.id} onClick={() => assignConsultant(sel, c.name)}
                      style={{ display: "flex", alignItems: "center", gap: 8, padding: "8px 10px", borderRadius: 8, border: `1px solid ${sel.assignee===c.name?"#6366F150":"#E2E8F0"}`, background: sel.assignee===c.name?"#1E40AF12":"#F8FAFC", color: sel.assignee===c.name?"#1D4ED8":"#64748B", fontSize: 12, fontWeight: sel.assignee===c.name?700:400, cursor: "pointer", textAlign: "left" }}>
                      <div style={{ width: 22, height: 22, borderRadius: "50%", background: sel.assignee===c.name?"#1E40AF25":"#E2E8F0", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 10, fontWeight: 700, color: sel.assignee===c.name?"#1D4ED8":"#64748B" }}>{(c.name||"?")[0]}</div>
                      {c.name}
                      {sel.assignee===c.name && <span style={{ marginLeft: "auto", color: "#059669" }}>✓</span>}
                    </button>
                  ))}
                </div>
              </div>
            )}

            {/* Durum Değiştir */}
            {(isAdmin || isConsultant) && (
              <div style={{ background: "#FFFFFF", border: "1px solid #1E2130", borderRadius: 14, padding: "18px" }}>
                <h3 style={{ fontSize: 13, fontWeight: 700, color: "#1E3A5F", marginBottom: 12 }}>🔄 Durum</h3>
                {["Open","In Progress","Waiting","Closed"].map(s => (
                  <button key={s} onClick={() => changeStatus(sel, s)}
                    style={{ display: "flex", alignItems: "center", gap: 8, width: "100%", marginBottom: 6, padding: "9px 12px", borderRadius: 8, border: `1px solid ${sel.status===s?STATUS_CONFIG[s].color+"50":"#E2E8F0"}`, background: sel.status===s?STATUS_CONFIG[s].bg:"#F8FAFC", color: sel.status===s?STATUS_CONFIG[s].color:"#64748B", fontSize: 12, fontWeight: sel.status===s?700:400, cursor: "pointer" }}>
                    <span style={{ width: 7, height: 7, borderRadius: "50%", background: STATUS_CONFIG[s].color, display: "inline-block" }} />
                    {STATUS_CONFIG[s].label}
                    {sel.status===s && <span style={{ marginLeft: "auto" }}>✓</span>}
                  </button>
                ))}
              </div>
            )}

            {/* Ticket Özeti */}
            <div style={{ background: "#FFFFFF", border: "1px solid #1E2130", borderRadius: 14, padding: "18px" }}>
              <h3 style={{ fontSize: 13, fontWeight: 700, color: "#1E3A5F", marginBottom: 12 }}>📋 Detaylar</h3>
              {[
                ["Firma", company?.name],
                ["Ticket No", sel.no],
                ["Atanan", sel.assignee || "Atanmadı"],
                ["Açılış", sel.created_at?.slice(0,10)],
                ["Toplam Efor", totalHrs + " saat"],
                ["Mesaj", ticketMsgs.length + " adet"],
              ].map(([l,v]) => (
                <div key={l} style={{ display: "flex", justifyContent: "space-between", padding: "7px 0", borderBottom: "1px solid #1E213050" }}>
                  <span style={{ fontSize: 12, color: "#64748B" }}>{l}</span>
                  <span style={{ fontSize: 12, color: l==="Atanan" && !sel.assignee ? "#F59E0B" : "#334E68", fontWeight: 500, fontFamily: l==="Ticket No"?"'DM Mono',monospace":"inherit" }}>{v || "—"}</span>
                </div>
              ))}
            </div>
          </div>
        </div>
      </div>
    );
  }

  // ── TICKET LIST (CARD VIEW) ──
  const statusGroups = ["Open","In Progress","Waiting","Closed"];

  return (
    <div className="page-enter">
      <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start", marginBottom: 20 }}>
        <div>
          <h2 style={{ fontSize: 20, fontWeight: 700, color: "#1E3A5F" }}>Ticket'lar</h2>
          <p style={{ fontSize: 13, color: "#64748B", marginTop: 3 }}>{filtered.length} ticket</p>
        </div>
        <Btn icon="plus" onClick={() => setShowModal(true)}>Yeni Ticket</Btn>
      </div>

      {/* Filtreler */}
      <div style={{ display: "flex", gap: 8, marginBottom: 20, flexWrap: "wrap" }}>
        {["all",...statusGroups].map(s => (
          <button key={s} onClick={() => setFStatus(s)}
            style={{ padding: "6px 14px", borderRadius: 8, border: `1px solid ${fStatus===s?(STATUS_CONFIG[s]?.color||"#1D4ED8"):"#E2E8F0"}`, background: fStatus===s?(STATUS_CONFIG[s]?.bg||"#1E40AF12"):"#F8FAFC", color: fStatus===s?(STATUS_CONFIG[s]?.color||"#1D4ED8"):"#64748B", fontSize: 12, fontWeight: 600, cursor: "pointer" }}>
            {s==="all"?"Tümü":STATUS_CONFIG[s]?.label} {s!=="all" && <span style={{ opacity: 0.7 }}>({tickets.filter(t=>t.status===s).length})</span>}
          </button>
        ))}
      </div>

      {/* CARD GRID */}
      {filtered.length === 0
        ? <div style={{ textAlign: "center", padding: "60px 0", color: "#64748B" }}><div style={{ fontSize: 40, marginBottom: 12 }}>🎫</div>Ticket bulunamadı.</div>
        : <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fill, minmax(320px, 1fr))", gap: 14 }}>
          {filtered.map(t => {
            const pc = PRIORITY_CONFIG[t.priority] || {};
            const sc = STATUS_CONFIG[t.status] || {};
            const co = companies.find(c => c.id === t.company_id);
            const tEfors = timesheets.filter(e => e.ticket_no === t.no);
            const tHrs = tEfors.reduce((s, e) => s + (e.hours || 0), 0);
            const needsAssign = !t.assignee && isAdmin;
            return (
              <div key={t.id} onClick={() => setSel(t)} style={{ background: "#FFFFFF", border: `1px solid ${needsAssign?"#F59E0B40":"#E2E8F0"}`, borderRadius: 14, padding: "18px", cursor: "pointer", position: "relative", overflow: "hidden", transition: "transform 0.15s, box-shadow 0.15s" }}
                onMouseEnter={e => { e.currentTarget.style.transform="translateY(-2px)"; e.currentTarget.style.boxShadow="0 8px 24px rgba(0,0,0,0.3)"; }}
                onMouseLeave={e => { e.currentTarget.style.transform="none"; e.currentTarget.style.boxShadow="none"; }}>
                {/* Priority bar */}
                <div style={{ position: "absolute", top: 0, left: 0, right: 0, height: 3, background: pc.color || "#1D4ED8" }} />

                {/* Header */}
                <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start", marginBottom: 10 }}>
                  <span style={{ fontSize: 10, color: "#1D4ED8", fontFamily: "'DM Mono',monospace", fontWeight: 700, background: "#EFF6FF", padding: "2px 8px", borderRadius: 4 }}>{t.no}</span>
                  <div style={{ display: "flex", gap: 6 }}>
                    {pc.color && <Badge {...pc} label={pc.label} />}
                    {sc.color && <Badge {...sc} label={sc.label} />}
                  </div>
                </div>

                {/* Title */}
                <h3 style={{ fontSize: 14, fontWeight: 700, color: "#1E3A5F", marginBottom: 6, lineHeight: 1.4 }}>{t.title}</h3>

                {/* Description preview */}
                <p style={{ fontSize: 12, color: "#64748B", marginBottom: 12, lineHeight: 1.5, display: "-webkit-box", WebkitLineClamp: 2, WebkitBoxOrient: "vertical", overflow: "hidden" }}>{t.description || "Açıklama yok"}</p>

                {/* Company */}
                <div style={{ fontSize: 11, color: "#64748B", marginBottom: 12, display: "flex", alignItems: "center", gap: 5 }}>
                  🏢 <span style={{ color: "#64748B", fontWeight: 500 }}>{co?.name || "—"}</span>
                </div>

                {/* Footer */}
                <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", paddingTop: 10, borderTop: "1px solid #1E213060" }}>
                  <div style={{ display: "flex", alignItems: "center", gap: 6 }}>
                    {t.assignee ? (
                      <div style={{ display: "flex", alignItems: "center", gap: 5 }}>
                        <div style={{ width: 22, height: 22, borderRadius: "50%", background: "#1E40AF25", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 10, fontWeight: 700, color: "#1D4ED8" }}>{t.assignee[0]}</div>
                        <span style={{ fontSize: 11, color: "#64748B" }}>{t.assignee}</span>
                      </div>
                    ) : (
                      <span style={{ fontSize: 11, color: "#F59E0B", background: "#F59E0B12", padding: "2px 8px", borderRadius: 4, fontWeight: 600 }}>⚠ Atanmadı</span>
                    )}
                  </div>
                  <div style={{ display: "flex", alignItems: "center", gap: 10 }}>
                    {tHrs > 0 && <span style={{ fontSize: 11, color: "#64748B" }}>⏱ {tHrs}s</span>}
                    <span style={{ fontSize: 11, color: "#94A3B8" }}>{t.created_at?.slice(0,10)}</span>
                  </div>
                </div>
              </div>
            );
          })}
        </div>
      }

      {/* NEW TICKET MODAL */}
      {showModal && (
        <Modal title="Yeni Ticket" onClose={() => setShowModal(false)}>
          <FormField label="Başlık" required><input style={inp} value={form.title} onChange={e => setForm(p => ({ ...p, title: e.target.value }))} placeholder="Ticket başlığı" autoFocus /></FormField>
          <FormField label="Açıklama"><textarea style={{ ...inp, height: 90, resize: "vertical" }} value={form.description} onChange={e => setForm(p => ({ ...p, description: e.target.value }))} placeholder="Sorunu detaylı açıklayın..." /></FormField>
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: "0 14px" }}>
            {!isCustomer && (
              <FormField label="Firma" required>
                <select style={inp} value={form.company_id} onChange={e => setForm(p => ({ ...p, company_id: e.target.value }))}>
                  <option value="">Seçin...</option>
                  {companies.map(c => <option key={c.id} value={c.id}>{c.name}</option>)}
                </select>
              </FormField>
            )}
            <FormField label="Öncelik">
              <select style={inp} value={form.priority} onChange={e => setForm(p => ({ ...p, priority: e.target.value }))}>
                {["Low","Medium","High","Critical"].map(p => <option key={p}>{p}</option>)}
              </select>
            </FormField>
            {isAdmin && (
              <FormField label="Danışman Ata">
                <select style={inp} value={form.assignee} onChange={e => setForm(p => ({ ...p, assignee: e.target.value }))}>
                  <option value="">Sonra ata...</option>
                  {consultants.map(c => <option key={c.id} value={c.name}>{c.name}</option>)}
                </select>
              </FormField>
            )}
          </div>
          <div style={{ display: "flex", gap: 10, justifyContent: "flex-end", marginTop: 10 }}>
            <Btn variant="secondary" onClick={() => setShowModal(false)}>İptal</Btn>
            <Btn onClick={save} loading={saving} disabled={!form.title || (!isCustomer && !form.company_id)}>Oluştur</Btn>
          </div>
        </Modal>
      )}
    </div>
  );
}

// ─── TIMESHEET ────────────────────────────────────────────────────────────────
function TimesheetPage({ timesheets, tickets, consultants, reload, showToast, profile }) {
  const [showModal, setShowModal] = useState(false);
  const [saving, setSaving] = useState(false);
  const empty = { consultant: "", ticket_no: "", date: new Date().toISOString().slice(0,10), hours: "", description: "" };
  const [form, setForm] = useState(empty);
  const openTickets = tickets.filter(t => t.status !== "Closed");
  const total = timesheets.reduce((s, t) => s + (t.hours || 0), 0);
  const billed = timesheets.filter(t => t.billed).reduce((s, t) => s + (t.hours || 0), 0);

  const save = async () => {
    if (!form.ticket_no || !form.hours) return;
    setSaving(true);
    const { error } = await supabase.from("time_entries").insert([{ ...form, hours: +form.hours, billed: false }]);
    setSaving(false);
    if (error) { showToast(error.message, "error"); return; }
    showToast("Efor kaydedildi!"); setShowModal(false); setForm(empty); reload();
  };

  return (
    <div className="page-enter">
      <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start", marginBottom: 20 }}>
        <div><h2 style={{ fontSize: 20, fontWeight: 700, color: "#1E3A5F" }}>Efor Girişi</h2><p style={{ fontSize: 13, color: "#64748B", marginTop: 3 }}>Günlük çalışma saatleri</p></div>
        <Btn icon="plus" onClick={() => setShowModal(true)}>Efor Gir</Btn>
      </div>
      <div style={{ display: "grid", gridTemplateColumns: "repeat(3,1fr)", gap: 14, marginBottom: 20 }}>
        <StatCard label="Toplam" value={total.toFixed(1) + "s"} color="#1D4ED8" icon="clock" />
        <StatCard label="Faturalandı" value={billed.toFixed(1) + "s"} color="#059669" icon="check" />
        <StatCard label="Bekliyor" value={(total-billed).toFixed(1) + "s"} color="#F59E0B" icon="clock" />
      </div>
      <div style={{ background: "#FFFFFF", border: "1px solid #1E2130", borderRadius: 12, overflow: "hidden" }}>
        {timesheets.length === 0
          ? <div style={{ padding: "50px", textAlign: "center", color: "#64748B" }}><div style={{ fontSize: 32, marginBottom: 10 }}>⏱️</div>Henüz efor girilmedi.</div>
          : <table style={{ width: "100%", borderCollapse: "collapse" }}>
            <thead><tr style={{ borderBottom: "1px solid #1E2130" }}>{["Danışman","Ticket","Tarih","Süre","Açıklama","Durum"].map(h => <th key={h} style={{ padding: "11px 13px", fontSize: 11, fontWeight: 600, color: "#64748B", textAlign: "left", textTransform: "uppercase", letterSpacing: 0.5 }}>{h}</th>)}</tr></thead>
            <tbody>
              {timesheets.map(t => (
                <tr key={t.id} className="tr-hover" style={{ borderBottom: "1px solid #1E213040" }}>
                  <td style={{ padding: "10px 13px", fontSize: 13, color: "#334E68", fontWeight: 500 }}>{t.consultant}</td>
                  <td style={{ padding: "10px 13px", fontSize: 12, color: "#1D4ED8", fontFamily: "'DM Mono',monospace" }}>{t.ticket_no}</td>
                  <td style={{ padding: "10px 13px", fontSize: 12, color: "#64748B" }}>{t.date}</td>
                  <td style={{ padding: "10px 13px", fontSize: 13, fontWeight: 700, color: "#1E3A5F", fontFamily: "'DM Mono',monospace" }}>{t.hours}s</td>
                  <td style={{ padding: "10px 13px", fontSize: 12, color: "#64748B", maxWidth: 180 }}><span style={{ display: "block", whiteSpace: "nowrap", overflow: "hidden", textOverflow: "ellipsis" }}>{t.description}</span></td>
                  <td style={{ padding: "10px 13px" }}>{t.billed ? <Badge label="Faturalandı" color="#059669" bg="#D1FAE5" /> : <Badge label="Bekliyor" color="#F59E0B" bg="#F59E0B18" />}</td>
                </tr>
              ))}
            </tbody>
          </table>
        }
      </div>
      {showModal && (
        <Modal title="Efor Kaydı" onClose={() => setShowModal(false)}>
          <FormField label="Danışman"><select style={inp} value={form.consultant} onChange={e => setForm(p => ({ ...p, consultant: e.target.value }))}>{consultants.map(c => <option key={c.id} value={c.name}>{c.name}</option>)}</select></FormField>
          <FormField label="Ticket" required><select style={inp} value={form.ticket_no} onChange={e => setForm(p => ({ ...p, ticket_no: e.target.value }))}><option value="">Seçin...</option>{openTickets.map(t => <option key={t.no} value={t.no}>{t.no} – {t.title}</option>)}</select></FormField>
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: "0 14px" }}>
            <FormField label="Tarih"><input type="date" style={inp} value={form.date} onChange={e => setForm(p => ({ ...p, date: e.target.value }))} /></FormField>
            <FormField label="Süre (Saat)" required><input type="number" step="0.5" style={inp} value={form.hours} onChange={e => setForm(p => ({ ...p, hours: e.target.value }))} /></FormField>
          </div>
          <FormField label="Açıklama"><textarea style={{ ...inp, height: 65, resize: "vertical" }} value={form.description} onChange={e => setForm(p => ({ ...p, description: e.target.value }))} /></FormField>
          <div style={{ display: "flex", gap: 10, justifyContent: "flex-end", marginTop: 8 }}>
            <Btn variant="secondary" onClick={() => setShowModal(false)}>İptal</Btn>
            <Btn onClick={save} loading={saving} disabled={!form.ticket_no || !form.hours}>Kaydet</Btn>
          </div>
        </Modal>
      )}
    </div>
  );
}

// ─── INVOICES ────────────────────────────────────────────────────────────────
function InvoicesPage({ invoices, companies, timesheets, tickets, reload, showToast, isAdmin, isCustomer }) {
  const [step, setStep] = useState(0);
  const [sel, setSel] = useState({ companyId: "" });
  const [preview, setPreview] = useState(null);
  const [saving, setSaving] = useState(false);

  const unbilled = timesheets.filter(t => {
    if (t.billed) return false;
    const ticket = tickets.find(tk => tk.no === t.ticket_no);
    return ticket?.company_id === sel.companyId;
  });
  const company = companies.find(c => c.id === sel.companyId);
  const totalHours = unbilled.reduce((s, t) => s + (t.hours || 0), 0);
  const subtotal = totalHours * (company?.hourly_rate || 0);
  const vat = subtotal * 0.18;
  const total = subtotal + vat;

  const createInvoice = async () => {
    if (!preview) return;
    setSaving(true);
    const no = "INV-" + new Date().getFullYear() + "-" + String(invoices.length + 1).padStart(3, "0");
    const { error } = await supabase.from("invoices").insert([{ no, company_id: sel.companyId, company_name: company.name, date: new Date().toISOString().slice(0,10), total_hours: totalHours, unit_rate: company.hourly_rate, subtotal, vat, total, currency: company.currency || "TRY", status: "Bekliyor" }]);
    if (error) { showToast(error.message, "error"); setSaving(false); return; }
    for (const t of unbilled) await supabase.from("time_entries").update({ billed: true, invoice_no: no }).eq("id", t.id);
    showToast("Fatura oluşturuldu!"); setSaving(false); setStep(0); setPreview(null); reload();
  };

  return (
    <div className="page-enter">
      <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start", marginBottom: 20 }}>
        <div><h2 style={{ fontSize: 20, fontWeight: 700, color: "#1E3A5F" }}>Faturalama</h2><p style={{ fontSize: 13, color: "#64748B", marginTop: 3 }}>{invoices.length} fatura</p></div>
        {isAdmin && step === 0 && <Btn icon="plus" onClick={() => setStep(1)}>Fatura Oluştur</Btn>}
        {isAdmin && step === 1 && <Btn variant="secondary" onClick={() => { setStep(0); setPreview(null); }}>← Geri</Btn>}
      </div>

      {step === 0 && (
        <div style={{ background: "#FFFFFF", border: "1px solid #1E2130", borderRadius: 12, overflow: "hidden" }}>
          {invoices.length === 0
            ? <div style={{ padding: "50px", textAlign: "center", color: "#64748B" }}><div style={{ fontSize: 32, marginBottom: 10 }}>🧾</div>Henüz fatura yok.</div>
            : <table style={{ width: "100%", borderCollapse: "collapse" }}>
              <thead><tr style={{ borderBottom: "1px solid #1E2130" }}>{["Fatura No","Firma","Tarih","Saat","Toplam","Durum"].map(h => <th key={h} style={{ padding: "11px 13px", fontSize: 11, fontWeight: 600, color: "#64748B", textAlign: "left", textTransform: "uppercase", letterSpacing: 0.5 }}>{h}</th>)}</tr></thead>
              <tbody>
                {invoices.map(inv => (
                  <tr key={inv.id} className="tr-hover" style={{ borderBottom: "1px solid #1E213040" }}>
                    <td style={{ padding: "11px 13px", fontSize: 12, color: "#1D4ED8", fontFamily: "'DM Mono',monospace", fontWeight: 600 }}>{inv.no}</td>
                    <td style={{ padding: "11px 13px", fontSize: 13, color: "#334E68" }}>{inv.company_name}</td>
                    <td style={{ padding: "11px 13px", fontSize: 12, color: "#64748B" }}>{inv.date}</td>
                    <td style={{ padding: "11px 13px", fontSize: 12, color: "#64748B", fontFamily: "'DM Mono',monospace" }}>{inv.total_hours}s</td>
                    <td style={{ padding: "11px 13px", fontSize: 13, fontWeight: 700, color: "#1E3A5F", fontFamily: "'DM Mono',monospace" }}>₺{(inv.total||0).toLocaleString("tr")}</td>
                    <td style={{ padding: "11px 13px" }}><Badge label={inv.status} color={inv.status==="Ödendi"?"#059669":"#F59E0B"} bg={inv.status==="Ödendi"?"#D1FAE5":"#F59E0B18"} /></td>
                  </tr>
                ))}
              </tbody>
            </table>
          }
        </div>
      )}

      {step === 1 && isAdmin && (
        <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 16 }}>
          <div style={{ background: "#FFFFFF", border: "1px solid #1E2130", borderRadius: 12, padding: "22px" }}>
            <h3 style={{ fontSize: 15, fontWeight: 700, color: "#1E3A5F", marginBottom: 16 }}>Parametreler</h3>
            <FormField label="Firma" required>
              <select style={inp} value={sel.companyId} onChange={e => { setSel({ companyId: e.target.value }); setPreview(null); }}>
                <option value="">Firma seçin...</option>
                {companies.map(c => <option key={c.id} value={c.id}>{c.name}</option>)}
              </select>
            </FormField>
            {sel.companyId && (
              <div style={{ background: "#F8FAFC", borderRadius: 8, padding: "12px", marginBottom: 14 }}>
                <div style={{ fontSize: 11, color: "#64748B", fontWeight: 600, marginBottom: 8, textTransform: "uppercase" }}>Faturalanmamış ({unbilled.length} kayıt)</div>
                {unbilled.length === 0 ? <p style={{ fontSize: 12, color: "#64748B" }}>Faturalanmamış efor yok.</p>
                  : unbilled.map(t => (
                    <div key={t.id} style={{ display: "flex", justifyContent: "space-between", marginBottom: 5 }}>
                      <span style={{ fontSize: 12, color: "#64748B" }}>{t.date} · {t.ticket_no}</span>
                      <span style={{ fontSize: 12, fontWeight: 600, color: "#1D4ED8", fontFamily: "'DM Mono',monospace" }}>{t.hours}s</span>
                    </div>
                  ))}
              </div>
            )}
            <Btn onClick={() => setPreview({ company, totalHours, subtotal, vat, total })} disabled={!sel.companyId || totalHours === 0} style={{ width: "100%", justifyContent: "center" }}>Önizle</Btn>
          </div>
          <div style={{ background: "#FFFFFF", border: "1px solid #1E2130", borderRadius: 12, padding: "22px" }}>
            {!preview ? <div style={{ display: "flex", alignItems: "center", justifyContent: "center", height: "100%", color: "#64748B", textAlign: "center" }}><div><div style={{ fontSize: 32, marginBottom: 10 }}>📄</div>Önizlemek için firma seçin</div></div>
              : <div style={{ animation: "fadeIn 0.3s ease" }}>
                <h3 style={{ fontSize: 15, fontWeight: 700, color: "#1E3A5F", marginBottom: 14 }}>Fatura Önizleme</h3>
                <div style={{ background: "#F8FAFC", borderRadius: 10, padding: "16px", marginBottom: 14, border: "1px solid #1E2130" }}>
                  {[["Firma", preview.company?.name], ["Toplam Saat", `${preview.totalHours}s`], ["Birim Ücret", `₺${preview.company?.hourly_rate}/s`]].map(([l, v]) => (
                    <div key={l} style={{ display: "flex", justifyContent: "space-between", marginBottom: 7 }}><span style={{ fontSize: 13, color: "#64748B" }}>{l}</span><span style={{ fontSize: 13, color: "#1E3A5F", fontWeight: 600 }}>{v}</span></div>
                  ))}
                  <div style={{ borderTop: "1px solid #1E2130", paddingTop: 10, marginTop: 4 }}>
                    <div style={{ display: "flex", justifyContent: "space-between", marginBottom: 6 }}><span style={{ fontSize: 13, color: "#64748B" }}>Ara Toplam</span><span style={{ fontSize: 13, color: "#1E3A5F", fontFamily: "'DM Mono',monospace" }}>₺{preview.subtotal.toLocaleString("tr")}</span></div>
                    <div style={{ display: "flex", justifyContent: "space-between", marginBottom: 10 }}><span style={{ fontSize: 13, color: "#64748B" }}>KDV %18</span><span style={{ fontSize: 13, color: "#64748B", fontFamily: "'DM Mono',monospace" }}>₺{preview.vat.toLocaleString("tr")}</span></div>
                    <div style={{ display: "flex", justifyContent: "space-between", background: "#1E40AF12", borderRadius: 7, padding: "10px 12px" }}>
                      <span style={{ fontSize: 15, fontWeight: 700, color: "#1E3A5F" }}>Genel Toplam</span>
                      <span style={{ fontSize: 15, fontWeight: 700, color: "#1D4ED8", fontFamily: "'DM Mono',monospace" }}>₺{preview.total.toLocaleString("tr")}</span>
                    </div>
                  </div>
                </div>
                <Btn onClick={createInvoice} loading={saving} style={{ width: "100%", justifyContent: "center" }}>Oluştur & Kilitle</Btn>
              </div>
            }
          </div>
        </div>
      )}
    </div>
  );
}

// ─── REPORTS ─────────────────────────────────────────────────────────────────
function ReportsPage({ timesheets, tickets, companies, invoices, consultants }) {
  const [tab, setTab] = useState("effort");
  const effortByCompany = companies.map(c => {
    const nos = tickets.filter(t => t.company_id === c.id).map(t => t.no);
    const entries = timesheets.filter(t => nos.includes(t.ticket_no));
    const total = entries.reduce((s, t) => s + (t.hours || 0), 0);
    const billed = entries.filter(t => t.billed).reduce((s, t) => s + (t.hours || 0), 0);
    return { ...c, total, billed, unbilled: total - billed };
  });
  const byConsultant = consultants.map(({name}) => {
    const e = timesheets.filter(t => t.consultant === name);
    return { name, hours: e.reduce((s, t) => s + (t.hours || 0), 0), count: e.length };
  }).sort((a, b) => b.hours - a.hours);
  const maxH = Math.max(...byConsultant.map(c => c.hours), 1);

  return (
    <div className="page-enter">
      <div style={{ marginBottom: 20 }}><h2 style={{ fontSize: 20, fontWeight: 700, color: "#1E3A5F" }}>Raporlar</h2></div>
      <div style={{ display: "flex", gap: 8, marginBottom: 20 }}>
        {[["effort","Efor Analizi"],["consultant","Danışman Performansı"],["invoice","Fatura Geçmişi"]].map(([id, label]) => (
          <button key={id} onClick={() => setTab(id)} style={{ padding: "8px 16px", borderRadius: 8, border: "1px solid " + (tab===id?"#1D4ED8":"#E2E8F0"), background: tab===id?"#1E40AF12":"#F8FAFC", color: tab===id?"#1D4ED8":"#64748B", fontSize: 13, fontWeight: 600, cursor: "pointer" }}>{label}</button>
        ))}
      </div>

      {tab === "effort" && (
        <div style={{ background: "#FFFFFF", border: "1px solid #1E2130", borderRadius: 12, padding: "22px" }}>
          <h3 style={{ fontSize: 15, fontWeight: 700, color: "#1E3A5F", marginBottom: 16 }}>Firma Bazlı Efor</h3>
          {effortByCompany.map(c => (
            <div key={c.id} style={{ marginBottom: 16, paddingBottom: 16, borderBottom: "1px solid #1E213050" }}>
              <div style={{ display: "flex", justifyContent: "space-between", marginBottom: 7 }}>
                <span style={{ fontSize: 14, fontWeight: 600, color: "#1E3A5F" }}>{c.name}</span>
                <span style={{ fontSize: 14, fontWeight: 700, color: "#1D4ED8", fontFamily: "'DM Mono',monospace" }}>{c.total}s</span>
              </div>
              <div style={{ display: "flex", gap: 4, height: 8, marginBottom: 6 }}>
                {c.billed > 0 && <div style={{ flex: c.billed, background: "#059669", borderRadius: 4 }} />}
                {c.unbilled > 0 && <div style={{ flex: c.unbilled, background: "#F59E0B40", borderRadius: 4, border: "1px solid #F59E0B50" }} />}
                {c.total === 0 && <div style={{ flex: 1, background: "#E2E8F0", borderRadius: 4 }} />}
              </div>
              <div style={{ display: "flex", gap: 14 }}>
                <span style={{ fontSize: 11, color: "#059669" }}>● Faturalandı: {c.billed}s</span>
                <span style={{ fontSize: 11, color: "#F59E0B" }}>● Bekliyor: {c.unbilled.toFixed(1)}s</span>
              </div>
            </div>
          ))}
        </div>
      )}

      {tab === "consultant" && (
        <div style={{ background: "#FFFFFF", border: "1px solid #1E2130", borderRadius: 12, padding: "22px" }}>
          <h3 style={{ fontSize: 15, fontWeight: 700, color: "#1E3A5F", marginBottom: 16 }}>Danışman Performansı</h3>
          {byConsultant.map((c, i) => (
            <div key={c.name} style={{ display: "flex", alignItems: "center", gap: 14, marginBottom: 12, padding: "12px 14px", background: "#F8FAFC", borderRadius: 9 }}>
              <div style={{ width: 28, height: 28, borderRadius: "50%", background: i===0?"linear-gradient(135deg,#1E3A8A,#0E7490)":"#E2E8F0", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 11, fontWeight: 700, color: i===0?"#fff":"#64748B", flexShrink: 0 }}>#{i+1}</div>
              <div style={{ flex: 1 }}>
                <div style={{ display: "flex", justifyContent: "space-between", marginBottom: 4 }}>
                  <span style={{ fontSize: 13, fontWeight: 600, color: "#1E3A5F" }}>{c.name}</span>
                  <span style={{ fontSize: 13, fontWeight: 700, color: "#1D4ED8", fontFamily: "'DM Mono',monospace" }}>{c.hours}s</span>
                </div>
                <div style={{ height: 5, background: "#E2E8F0", borderRadius: 3 }}>
                  <div style={{ height: "100%", width: `${(c.hours/maxH)*100}%`, background: i===0?"linear-gradient(90deg,#6366F1,#8B5CF6)":"#94A3B8", borderRadius: 3 }} />
                </div>
              </div>
            </div>
          ))}
        </div>
      )}

      {tab === "invoice" && (
        <div style={{ background: "#FFFFFF", border: "1px solid #1E2130", borderRadius: 12, padding: "22px" }}>
          <h3 style={{ fontSize: 15, fontWeight: 700, color: "#1E3A5F", marginBottom: 16 }}>Fatura Geçmişi</h3>
          {invoices.length === 0 ? <div style={{ color: "#64748B", fontSize: 13 }}>Henüz fatura yok.</div> : invoices.map(inv => (
            <div key={inv.id} style={{ display: "flex", justifyContent: "space-between", alignItems: "center", padding: "13px 15px", background: "#F8FAFC", borderRadius: 9, marginBottom: 9 }}>
              <div>
                <div style={{ fontSize: 13, fontWeight: 700, color: "#1D4ED8", fontFamily: "'DM Mono',monospace", marginBottom: 3 }}>{inv.no}</div>
                <div style={{ fontSize: 12, color: "#64748B" }}>{inv.company_name} · {inv.date}</div>
              </div>
              <div style={{ textAlign: "right" }}>
                <div style={{ fontSize: 14, fontWeight: 700, color: "#1E3A5F", fontFamily: "'DM Mono',monospace", marginBottom: 4 }}>₺{(inv.total||0).toLocaleString("tr")}</div>
                <Badge label={inv.status} color={inv.status==="Ödendi"?"#059669":"#F59E0B"} bg={inv.status==="Ödendi"?"#D1FAE5":"#F59E0B18"} />
              </div>
            </div>
          ))}
        </div>
      )}
    </div>
  );
}

// ─── ADMIN PANEL ─────────────────────────────────────────────────────────────
function AdminPage({ companies, showToast, reload }) {
  const [tab, setTab] = useState("users");
  const [profiles, setProfiles] = useState([]);
  const [loadingProfiles, setLoadingProfiles] = useState(true);
  const [showModal, setShowModal] = useState(false);
  const [saving, setSaving] = useState(false);
  const empty = { email: "", password: "", full_name: "", role: "customer", company_id: "" };
  const [form, setForm] = useState(empty);

  useEffect(() => {
    supabase.from("profiles").select("*, companies(name)").order("created_at", { ascending: false })
      .then(({ data }) => { setProfiles(data || []); setLoadingProfiles(false); });
  }, []);

  const createUser = async () => {
    if (!form.email || !form.password || !form.full_name) return;
    setSaving(true);
    // Create auth user via Supabase Admin (using service role would be ideal, but for demo we use signUp)
    const { data, error } = await supabase.auth.signUp({
      email: form.email,
      password: form.password,
      options: { data: { full_name: form.full_name, role: form.role } }
    });
    if (error) { showToast(error.message, "error"); setSaving(false); return; }
    // Update profile with company_id and role
    if (data.user) {
      await supabase.from("profiles").upsert({ id: data.user.id, email: form.email, full_name: form.full_name, role: form.role, company_id: form.company_id || null });
    }
    showToast("Kullanıcı oluşturuldu! E-posta onayı gerekebilir.");
    setSaving(false); setShowModal(false); setForm(empty);
    // Reload profiles
    const { data: p } = await supabase.from("profiles").select("*, companies(name)").order("created_at", { ascending: false });
    setProfiles(p || []);
  };

  const roleColors = { admin: { color: "#8B5CF6", bg: "#8B5CF618" }, consultant: { color: "#1D4ED8", bg: "#1E40AF12" }, customer: { color: "#059669", bg: "#D1FAE5" } };
  const roleLabels = { admin: "Admin", consultant: "Danışman", customer: "Müşteri" };

  return (
    <div className="page-enter">
      <div style={{ marginBottom: 20 }}>
        <h2 style={{ fontSize: 20, fontWeight: 700, color: "#1E3A5F", display: "flex", alignItems: "center", gap: 8 }}>
          <Icon name="shield" size={20} /> Admin Paneli
        </h2>
        <p style={{ fontSize: 13, color: "#64748B", marginTop: 3 }}>Kullanıcı ve sistem yönetimi</p>
      </div>

      <div style={{ display: "flex", gap: 8, marginBottom: 20 }}>
        {[["users","Kullanıcılar"],["settings","Sistem"]].map(([id, label]) => (
          <button key={id} onClick={() => setTab(id)} style={{ padding: "8px 16px", borderRadius: 8, border: "1px solid " + (tab===id?"#8B5CF6":"#E2E8F0"), background: tab===id?"#8B5CF618":"#F8FAFC", color: tab===id?"#A78BFA":"#64748B", fontSize: 13, fontWeight: 600, cursor: "pointer" }}>{label}</button>
        ))}
      </div>

      {tab === "users" && (
        <>
          <div style={{ display: "flex", justifyContent: "flex-end", marginBottom: 14 }}>
            <Btn icon="plus" onClick={() => setShowModal(true)}>Yeni Kullanıcı</Btn>
          </div>
          <div style={{ background: "#FFFFFF", border: "1px solid #1E2130", borderRadius: 12, overflow: "hidden" }}>
            {loadingProfiles ? <div style={{ padding: "40px", textAlign: "center", color: "#64748B" }}>Yükleniyor...</div>
              : profiles.length === 0 ? <div style={{ padding: "50px", textAlign: "center", color: "#64748B" }}>Kullanıcı bulunamadı.</div>
              : <table style={{ width: "100%", borderCollapse: "collapse" }}>
                <thead><tr style={{ borderBottom: "1px solid #1E2130" }}>{["Kullanıcı","E-posta","Rol","Firma","Tarih"].map(h => <th key={h} style={{ padding: "11px 14px", fontSize: 11, fontWeight: 600, color: "#64748B", textAlign: "left", textTransform: "uppercase", letterSpacing: 0.5 }}>{h}</th>)}</tr></thead>
                <tbody>
                  {profiles.map(u => (
                    <tr key={u.id} className="tr-hover" style={{ borderBottom: "1px solid #1E213040" }}>
                      <td style={{ padding: "12px 14px" }}>
                        <div style={{ display: "flex", alignItems: "center", gap: 10 }}>
                          <div style={{ width: 32, height: 32, borderRadius: "50%", background: (roleColors[u.role]?.bg || "#E2E8F0"), display: "flex", alignItems: "center", justifyContent: "center", fontSize: 12, fontWeight: 700, color: roleColors[u.role]?.color || "#64748B", flexShrink: 0 }}>
                            {(u.full_name || u.email || "?")[0].toUpperCase()}
                          </div>
                          <span style={{ fontSize: 13, fontWeight: 600, color: "#334E68" }}>{u.full_name || "—"}</span>
                        </div>
                      </td>
                      <td style={{ padding: "12px 14px", fontSize: 13, color: "#64748B" }}>{u.email}</td>
                      <td style={{ padding: "12px 14px" }}><Badge label={roleLabels[u.role] || u.role} color={roleColors[u.role]?.color || "#64748B"} bg={roleColors[u.role]?.bg || "#64748B18"} /></td>
                      <td style={{ padding: "12px 14px", fontSize: 12, color: "#64748B" }}>{u.companies?.name || "—"}</td>
                      <td style={{ padding: "12px 14px", fontSize: 11, color: "#64748B" }}>{u.created_at?.slice(0,10)}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            }
          </div>
        </>
      )}

      {tab === "settings" && (
        <div style={{ background: "#FFFFFF", border: "1px solid #1E2130", borderRadius: 12, padding: "24px" }}>
          <h3 style={{ fontSize: 15, fontWeight: 700, color: "#1E3A5F", marginBottom: 16 }}>Sistem Bilgileri</h3>
          {[["Platform", "ConsultFlow v2.0"], ["Veritabanı", "Supabase PostgreSQL"], ["Auth", "Supabase Auth"], ["Hosting", "Vercel"], ["Rol Sistemi", "Admin / Danışman / Müşteri"]].map(([l, v]) => (
            <div key={l} style={{ display: "flex", justifyContent: "space-between", padding: "12px 0", borderBottom: "1px solid #1E213060" }}>
              <span style={{ fontSize: 13, color: "#64748B" }}>{l}</span>
              <span style={{ fontSize: 13, color: "#334E68", fontWeight: 500 }}>{v}</span>
            </div>
          ))}
        </div>
      )}

      {showModal && (
        <Modal title="Yeni Kullanıcı Oluştur" onClose={() => setShowModal(false)} width={460}>
          <FormField label="Ad Soyad" required>
            <input style={inp} value={form.full_name} onChange={e => setForm(p => ({ ...p, full_name: e.target.value }))} placeholder="Ad Soyad" autoFocus />
          </FormField>
          <FormField label="E-posta" required>
            <input style={inp} type="email" value={form.email} onChange={e => setForm(p => ({ ...p, email: e.target.value }))} placeholder="ornek@firma.com" />
          </FormField>
          <FormField label="Şifre" required>
            <input style={inp} type="password" value={form.password} onChange={e => setForm(p => ({ ...p, password: e.target.value }))} placeholder="En az 6 karakter" />
          </FormField>
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: "0 14px" }}>
            <FormField label="Rol" required>
              <select style={inp} value={form.role} onChange={e => setForm(p => ({ ...p, role: e.target.value }))}>
                <option value="customer">Müşteri</option>
                <option value="consultant">Danışman</option>
                <option value="admin">Admin</option>
              </select>
            </FormField>
            {form.role === "customer" && (
              <FormField label="Firma">
                <select style={inp} value={form.company_id} onChange={e => setForm(p => ({ ...p, company_id: e.target.value }))}>
                  <option value="">Firma seçin...</option>
                  {companies.map(c => <option key={c.id} value={c.id}>{c.name}</option>)}
                </select>
              </FormField>
            )}
          </div>
          <div style={{ display: "flex", gap: 10, justifyContent: "flex-end", marginTop: 12 }}>
            <Btn variant="secondary" onClick={() => setShowModal(false)}>İptal</Btn>
            <Btn onClick={createUser} loading={saving} disabled={!form.email || !form.password || !form.full_name}>Oluştur</Btn>
          </div>
        </Modal>
      )}
    </div>
  );
}
